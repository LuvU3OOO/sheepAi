"use strict";const c=require("vue"),u=require("./config.cjs"),p=require("./index4.cjs"),x=require("./dom.cjs"),D=require("medium-zoom"),_=require("@vavt/util"),G=require("copy-to-clipboard"),j=require("markdown-it"),U=require("markdown-it-image-figures"),V=require("markdown-it-task-lists"),q=require("lru-cache"),z=(e,i)=>{const a=c.inject("editorId"),{noImgZoomIn:t}=e,n=_.debounce(()=>{const l=document.querySelectorAll(`#${a}-preview img`);l.length!==0&&D(l,{background:"#00000073"})});c.onMounted(()=>{!t&&n()}),c.watch([i,c.toRef(e.setting,"preview")],()=>{!t&&n()})},W=z,K=(e,i)=>{if(typeof i[e]=="string")return i[e];const a=`<i class="${u.prefix}-iconfont ${u.prefix}-icon-${e}"></i>`;switch(u.configOption.iconfontType){case"svg":return`<svg class="${u.prefix}-icon" aria-hidden="true"><use xlink:href="#${u.prefix}-icon-${e}"></use></svg>`;default:return a}},Z=(e,i,a)=>{const t=c.inject("editorId"),n=c.inject("usedLanguageText"),l=c.inject("customIcon"),r=()=>{document.querySelectorAll(`#${t}-preview pre`).forEach(d=>{var b,h;let o=-1;(b=d.querySelector(".copy-button"))==null||b.remove();const f=((h=n.value.copyCode)==null?void 0:h.text)||"复制代码",w=document.createElement("span");w.setAttribute("class","copy-button"),w.dataset.tips=f,w.innerHTML=K("copy",l.value),w.addEventListener("click",()=>{var k,I;clearTimeout(o);const v=d.querySelector("code").innerText,g=G(e.formatCopiedText(v)),C=((k=n.value.copyCode)==null?void 0:k.successTips)||"已复制！",y=((I=n.value.copyCode)==null?void 0:I.failTips)||"已复制！";w.dataset.tips=g?C:y,o=window.setTimeout(()=>{w.dataset.tips=f},1500)}),d.appendChild(w)})},m=()=>{c.nextTick(r)},s=d=>{d&&c.nextTick(r)};c.watch([i,a],m),c.watch(()=>e.setting.preview,s),c.watch(()=>e.setting.htmlPreview,s),c.watch(()=>n.value,r),c.onMounted(r)},J=Z,Q=e=>{var l;const i=(l=u.configOption.editorExtensions)==null?void 0:l.highlight,a=i==null?void 0:i.instance,t=c.inject("highlight"),n=c.shallowRef(a);return c.onMounted(()=>{if(!e.noHighlight&&!n.value){const r=document.createElement("script");r.src=t.value.js,r.onload=()=>{n.value=window.hljs},r.id=`${u.prefix}-hljs`,x.appendHandler(r,"hljs");const m=document.createElement("link");m.rel="stylesheet",m.href=t.value.css,m.id=`${u.prefix}-hlCss`,x.appendHandler(m)}}),c.watch(()=>t.value.css,r=>{x.updateHandler(`${u.prefix}-hlCss`,"href",r)}),n},X=Q,Y=e=>{const i=c.inject("theme"),{editorExtensions:a,mermaidConfig:t}=u.configOption,n=a==null?void 0:a.mermaid,l=c.shallowRef(n==null?void 0:n.instance),r=c.shallowRef(-1),m=new q({max:1e3,ttl:6e5}),s=()=>{const o=l.value;!e.noMermaid&&o&&(o.initialize(t({startOnLoad:!1,theme:i.value==="dark"?"dark":"default"})),r.value=r.value+1)};return c.watch(()=>i.value,()=>{m.clear(),s()}),c.onMounted(()=>{if(!e.noMermaid&&!(n!=null&&n.instance)){const o=(n==null?void 0:n.js)||u.mermaidUrl;if(/\.mjs/.test(o))import(o).then(f=>{l.value=f.default,s()});else{const f=document.createElement("script");f.id=`${u.prefix}-mermaid`,f.src=o,f.onload=()=>{l.value=window.mermaid,s()},x.appendHandler(f,"mermaid")}}}),{mermaidRef:l,reRenderRef:r,replaceMermaid:()=>{c.nextTick(()=>{if(!e.noMermaid&&l.value){const o=document.querySelectorAll(`div.${u.prefix}-mermaid`),f=document.createElement("div");f.style.width=document.body.offsetWidth+"px",f.style.height=document.body.offsetHeight+"px",f.style.position="fixed",f.style.zIndex="-10000",f.style.top="-10000";let w=o.length;w>0&&document.body.appendChild(f),o.forEach(async b=>{let h=m.get(b.innerText);if(!h){const g=_.uuid(),C=l.value.renderAsync||l.value.render;let y="";try{y=await C(g,b.innerText,f)}catch{}h=await e.sanitizeMermaid(typeof y=="string"?y:y.svg),m.set(b.innerText,h)}const v=document.createElement("p");v.className=`${u.prefix}-mermaid`,v.setAttribute("data-processed",""),v.innerHTML=h,b.dataset.line!==void 0&&(v.dataset.line=b.dataset.line),b.replaceWith(v),--w===0&&f.remove()})}})}}},ee=Y,te=e=>{var n;const i=(n=u.configOption.editorExtensions)==null?void 0:n.katex,a=i==null?void 0:i.instance,t=c.shallowRef(a);return c.onMounted(()=>{if(!e.noKatex&&!t.value){const l=document.createElement("script");l.src=(i==null?void 0:i.js)||u.katexUrl.js,l.onload=()=>{t.value=window.katex},l.id=`${u.prefix}-katex`;const r=document.createElement("link");r.rel="stylesheet",r.href=(i==null?void 0:i.css)||u.katexUrl.css,r.id=`${u.prefix}-katexCss`,x.appendHandler(l,"katex"),x.appendHandler(r)}}),t},ne=te,oe=(e,i)=>{const a=e.renderer.rules.fence.bind(e.renderer.rules);e.renderer.rules.fence=(t,n,l,r,m)=>{const s=t[n],d=s.content.trim();if(s.info==="mermaid"){let o;return t[n].map&&t[n].level===0&&(o=t[n].map[0],t[n].attrSet("data-line",String(o))),`<div class="${u.prefix}-mermaid" ${o!==void 0?"data-line="+o:""} data-mermaid-theme=${i.themeRef.value}>${d}</div>`}return a(t,n,l,r,m)}},re=oe,M=(e,i)=>{let a=!0,t=!0;const n=e.posMax,l=i>0?e.src.charCodeAt(i-1):-1,r=i+1<=n?e.src.charCodeAt(i+1):-1;return(l===32||l===9||r>=48&&r<=57)&&(t=!1),(r===32||r===9)&&(a=!1),{can_open:a,can_close:t}},ie=(e,i)=>{let a,t,n,l;if(e.src[e.pos]!=="$")return!1;if(n=M(e,e.pos),!n.can_open)return i||(e.pending+="$"),e.pos+=1,!0;const r=e.pos+1;for(a=r;(a=e.src.indexOf("$",a))!==-1;){for(l=a-1;e.src[l]==="\\";)l-=1;if((a-l)%2==1)break;a+=1}return a===-1?(i||(e.pending+="$"),e.pos=r,!0):a-r===0?(i||(e.pending+="$$"),e.pos=r+1,!0):(n=M(e,a),n.can_close?(i||(t=e.push("math_inline","math",0),t.markup="$",t.content=e.src.slice(r,a)),e.pos=a+1,!0):(i||(e.pending+="$"),e.pos=r,!0))},ae=(e,i,a,t)=>{let n,l,r,m,s=!1,d=e.bMarks[i]+e.tShift[i],o=e.eMarks[i];if(d+2>o||e.src.slice(d,d+2)!=="$$")return!1;if(d+=2,n=e.src.slice(d,o),t)return!0;for(n.trim().slice(-2)==="$$"&&(n=n.trim().slice(0,-2),s=!0),r=i;!s&&(r++,!(r>=a||(d=e.bMarks[r]+e.tShift[r],o=e.eMarks[r],d<o&&e.tShift[r]<e.blkIndent)));)e.src.slice(d,o).trim().slice(-2)==="$$"&&(m=e.src.slice(0,o).lastIndexOf("$$"),l=e.src.slice(d,m),s=!0);e.line=r+1;const f=e.push("math_block","math",0);return f.block=!0,f.content=(n&&n.trim()?n+`
`:"")+e.getLines(i+1,r,e.tShift[i],!0)+(l&&l.trim()?l:""),f.map=[i,e.line],f.markup="$$",!0},le=(e,i)=>{const a=n=>{if(i.katexRef.value){const l=i.katexRef.value.renderToString(n,{throwOnError:!1});return`<span class="${u.prefix}-katex-inline" data-processed>${l}</span>`}else return`<span class="${u.prefix}-katex-inline">${n}</span>`},t=(n,l)=>{if(i.katexRef.value){const r=i.katexRef.value.renderToString(n,{throwOnError:!1,displayMode:!0});return`<p class="${u.prefix}-katex-block" data-line=${l} data-processed>${r}</p>`}else return`<p class="${u.prefix}-katex-block" data-line=${l}>${n}</p>`};e.inline.ruler.after("escape","math_inline",ie),e.block.ruler.after("blockquote","math_block",ae,{alt:["paragraph","reference","blockquote","list"]}),e.renderer.rules.math_inline=(n,l)=>a(n[l].content),e.renderer.rules.math_block=(n,l)=>t(n[l].content,n[l].map[0])+`
`},ce=le,se=(e,i)=>{i=i||{};const a=3,t=i.marker||"!",n=t.charCodeAt(0),l=t.length;let r="",m="";const s=(o,f,w,b,h)=>{const v=o[f];return v.type==="admonition_open"?(o[f].attrPush(["class",`${u.prefix}-admonition ${u.prefix}-admonition-${v.info}`]),o[f].attrSet("data-line",String(o[f].map[0]))):v.type==="admonition_title_open"&&o[f].attrPush(["class",`${u.prefix}-admonition-title`]),h.renderToken(o,f,w)},d=o=>{const f=o.trim().split(" ",2);m="",r=f[0],f.length>1&&(m=o.substring(r.length+2)),(m===""||!m)&&(m=r)};e.block.ruler.before("code","admonition",(o,f,w,b)=>{let h,v,g,C=!1,y=o.bMarks[f]+o.tShift[f],k=o.eMarks[f];if(n!==o.src.charCodeAt(y))return!1;for(h=y+1;h<=k&&t[(h-y)%l]===o.src[h];h++);const I=Math.floor((h-y)/l);if(I!==a)return!1;h-=(h-y)%l;const $=o.src.slice(y,h),E=o.src.slice(h,k);if(d(E),b)return!0;for(v=f;v++,!(v>=w||(y=o.bMarks[v]+o.tShift[v],k=o.eMarks[v],y<k&&o.sCount[v]<o.blkIndent));)if(n===o.src.charCodeAt(y)&&!(o.sCount[v]-o.blkIndent>=4)){for(h=y+1;h<=k&&t[(h-y)%l]===o.src[h];h++);if(!(Math.floor((h-y)/l)<I)&&(h-=(h-y)%l,h=o.skipSpaces(h),!(h<k))){C=!0;break}}const P=o.parentType,S=o.lineMax;return o.parentType="root",o.lineMax=v,g=o.push("admonition_open","div",1),g.markup=$,g.block=!0,g.info=r,g.map=[f,v],g=o.push("admonition_title_open","p",1),g.markup=$+" "+r,g.map=[f,v],g=o.push("inline","",0),g.content=m,g.map=[f,o.line-1],g.children=[],g=o.push("admonition_title_close","p",-1),g.markup=$+" "+r,o.md.block.tokenize(o,f+1,v),g=o.push("admonition_close","div",-1),g.markup=o.src.slice(y,h),g.block=!0,o.parentType=P,o.lineMax=S,o.line=v+(C?1:0),!0},{alt:["paragraph","reference","blockquote","list"]}),e.renderer.rules.admonition_open=s,e.renderer.rules.admonition_title_open=s,e.renderer.rules.admonition_title_close=s,e.renderer.rules.admonition_close=s},ue=se,de=(e,i)=>{e.renderer.rules.heading_open=(a,t)=>{var m;const n=a[t],l=((m=a[t+1].children)==null?void 0:m.reduce((s,d)=>s+(d.content||""),""))||"",r=n.markup.length;return i.headsRef.value.push({text:l,level:r}),n.map&&n.level===0&&(n.attrSet("data-line",String(n.map[0])),n.attrSet("id",i.mdHeadingId(l,r,i.headsRef.value.length))),e.renderer.renderToken(a,t,i)},e.renderer.rules.heading_close=(a,t,n,l,r)=>r.renderToken(a,t,n)},pe=de,me=(e,i)=>{const a=e.renderer.rules.fence,t=e.utils.unescapeAll,n=/\[(\w*)(?::([\w ]*))?\]/;function l(d){return d.info?t(d.info).trim():""}function r(d){const o=l(d),[f=null,w=""]=(n.exec(o)||[]).slice(1);return[f,w]}function m(d){const o=l(d);return o?o.split(/(\s+)/g)[0]:""}const s=(d,o,f,w,b)=>{if(d[o].hidden)return"";const[h,v]=r(d[o]);if(h===null)return a(d,o,f,w,b);let g,C,y,k,I="",$="";for(let E=o;E<d.length&&(g=d[E],[C,y]=r(g),C===h);E++)g.info=g.info.replace(n,""),g.hidden=!0,k=E-o>0?"":" checked",I+=`<li><input type="radio" name="label-group-${i.editorId}-${o}"${k}><label for="group-${i.editorId}-${o}-tab-${E-o}" onclick="this.previousElementSibling.click()">${y||m(g)}</label></li>
`,$+=`<input type="radio" id="group-${i.editorId}-${o}-tab-${E-o}" name="group-${i.editorId}-${o}"${k}>
`+a(d,E,f,w,b);return`<div class="code-tabs">
<ul>
`+I+`</ul>
`+$+"</div>"};e.renderer.rules.fence=s},fe=me,he=e=>{["paragraph_open","table_open","ordered_list_open","bullet_list_open","blockquote_open","hr","html_block","fence"].forEach(i=>{const a=e.renderer.rules[i];a?e.renderer.rules[i]=(t,n,l,r,m)=>{let s;const d=a(t,n,l,r,m);return t[n].map&&t[n].level===0&&!/^<!--/.test(d)?(s=t[n].map[0],d.replace(/^(<[^>]*)/,`$1 data-line="${s}"`)):d}:e.renderer.rules[i]=(t,n,l,r,m)=>{let s;return t[n].map&&t[n].level===0&&(s=t[n].map[0],t[n].attrSet("data-line",String(s))),m.renderToken(t,n,l)}})},ge=(e,i)=>{const{editorConfig:a,markdownItConfig:t,markdownItPlugins:n}=u.configOption,l=c.inject("editorId"),r=c.inject("showCodeRowNumber"),m=c.inject("theme"),s=c.ref([]),d=X(e),o=ne(e),{reRenderRef:f,replaceMermaid:w}=ee(e),b=j({html:!0,breaks:!0});t(b,{editorId:l});const h=[{type:"katex",plugin:ce,options:{katexRef:o}},{type:"image",plugin:U,options:{figcaption:!0,classes:"md-zoom"}},{type:"admonition",plugin:ue,options:{}},{type:"taskList",plugin:V,options:{}},{type:"heading",plugin:pe,options:{mdHeadingId:e.mdHeadingId,headsRef:s}},{type:"codeTabs",plugin:fe,options:{editorId:l}}];e.noMermaid||h.push({type:"mermaid",plugin:re,options:{themeRef:m}}),n(h,{editorId:l}).forEach($=>{b.use($.plugin,$.options)});const v=b.options.highlight;b.set({highlight:($,E,P)=>{if(v){const T=v($,E,P);if(T)return T}let S;!e.noHighlight&&d.value?d.value.getLanguage(E)?S=d.value.highlight($,{language:E,ignoreIllegals:!0}).value:S=d.value.highlightAuto($).value:S=b.utils.escapeHtml($);const O=r?p.generateCodeRowNumber(S.replace(/^\n+|\n+$/g,"")):`<span class="code-block">${S.replace(/^\n+|\n+$/g,"")}</span>`;return`<pre><code class="language-${E}" language=${E}>${O}</code></pre>`}}),he(b);const g=c.ref(`_article-key_${_.uuid()}`),C=c.ref(e.sanitize(b.render(e.modelValue))),y=()=>{p.bus.emit(l,p.BUILD_FINISHED,C.value),e.onHtmlChanged(C.value),e.onGetCatalog(s.value),p.bus.emit(l,p.CATALOG_CHANGED,s.value),w()};c.onMounted(y);const k=()=>{s.value=[],C.value=e.sanitize(b.render(e.modelValue)),y()},I=c.computed(()=>(e.noKatex||o.value)&&(e.noHighlight||d.value));return c.watch([c.toRef(e,"modelValue"),I,f],_.debounce(k,(a==null?void 0:a.renderDelay)!==void 0?a==null?void 0:a.renderDelay:i?0:500)),c.onMounted(()=>{p.bus.on(l,{name:p.PUSH_CATALOG,callback(){p.bus.emit(l,p.CATALOG_CHANGED,s.value)}}),p.bus.on(l,{name:p.RERENDER,callback:()=>{k(),g.value=`_article-key_${_.uuid()}`}})}),{html:C,key:g}},ve=ge,A={modelValue:{type:String,default:""},setting:{type:Object,default:()=>({})},onHtmlChanged:{type:Function,default:()=>{}},onGetCatalog:{type:Function,default:()=>{}},mdHeadingId:{type:Function,default:()=>""},noMermaid:{type:Boolean,default:!1},sanitize:{type:Function,default:e=>e},noKatex:{type:Boolean,default:!1},formatCopiedText:{type:Function,default:e=>e},noHighlight:{type:Boolean,default:!1},previewOnly:{type:Boolean,default:!1},noImgZoomIn:{type:Boolean},sanitizeMermaid:{type:Function}},ye={...A,onChange:{type:Function,default:()=>{}},placeholder:{type:String,default:""},scrollAuto:{type:Boolean},autofocus:{type:Boolean},disabled:{type:Boolean},readonly:{type:Boolean},maxlength:{type:Number},autoDetectCode:{type:Boolean},onBlur:{type:Function,default:()=>{}},onFocus:{type:Function,default:()=>{}},noPrettier:{type:Boolean},completions:{type:Array},catalogVisible:{type:Boolean},theme:{type:String,default:"light"},onInput:{type:Function},onDrop:{type:Function,default:()=>{}},inputBoxWitdh:{type:String},onInputBoxWitdhChange:{type:Function}},R=c.defineComponent({name:"ContentPreview",props:A,setup(e){const i=c.inject("editorId"),a=c.inject("previewTheme"),t=c.inject("showCodeRowNumber"),{html:n,key:l}=ve(e,e.previewOnly);return J(e,n,l),W(e,n),()=>c.createVNode(c.Fragment,null,[c.createVNode("div",{id:`${i}-preview-wrapper`,class:`${u.prefix}-preview-wrapper`,"data-show":e.setting.preview,key:"content-preview-wrapper"},[c.createVNode("div",{key:l.value,id:`${i}-preview`,class:[`${u.prefix}-preview`,`${a==null?void 0:a.value}-theme`,t&&`${u.prefix}-scrn`],innerHTML:n.value},null)]),!e.previewOnly&&c.createVNode("div",{id:`${i}-html-wrapper`,class:`${u.prefix}-preview-wrapper`,"data-show":e.setting.htmlPreview,key:"html-preview-wrapper"},[c.createVNode("div",{class:`${u.prefix}-html`},[n.value])])])}}),be=(e,i)=>{const{editorId:a}=e,t=c.reactive({buildFinished:!1,html:""});c.watch(()=>e.modelValue,()=>{t.buildFinished=!1}),c.onMounted(()=>{p.bus.on(a,{name:p.BUILD_FINISHED,callback(n){t.buildFinished=!0,t.html=n}}),p.bus.on(a,{name:p.ON_SAVE,callback(){const n=new Promise(l=>{if(t.buildFinished)l(t.html);else{const r=m=>{l(m),p.bus.remove(a,p.BUILD_FINISHED,r)};p.bus.on(a,{name:p.BUILD_FINISHED,callback:r})}});e.onSave?e.onSave(e.modelValue,n):i.emit("onSave",e.modelValue,n)}})})},F=e=>{var n,l;const{editorId:i}=e,a=(l=(n=u.configOption)==null?void 0:n.editorExtensions)==null?void 0:l.highlight;c.provide("editorId",i),c.provide("theme",c.computed(()=>e.theme)),c.provide("language",c.computed(()=>e.language)),c.provide("highlight",c.computed(()=>{const r={...u.codeCss,...a==null?void 0:a.css},m=e.codeStyleReverse&&e.codeStyleReverseList.includes(e.previewTheme)?"dark":e.theme;return{js:(a==null?void 0:a.js)||u.highlightUrl,css:r[e.codeTheme]?r[e.codeTheme][m]:u.codeCss.atom[m]}})),c.provide("showCodeRowNumber",e.showCodeRowNumber);const t=c.computed(()=>{var m,s;const r={...u.staticTextDefault,...(s=(m=u.configOption)==null?void 0:m.editorConfig)==null?void 0:s.languageUserDefined};return r[e.language]?r[e.language]:u.staticTextDefault["zh-CN"]});c.provide("usedLanguageText",t),c.provide("previewTheme",c.computed(()=>e.previewTheme)),c.provide("customIcon",c.computed(()=>e.customIcon))},we=e=>{F(e),c.provide("tabWidth",e.tabWidth)},L=e=>{c.onMounted(()=>{var i,a;if(!e.noIconfont)if(u.configOption.iconfontType==="svg"){const t=document.createElement("script");t.src=((i=u.configOption.editorExtensions)==null?void 0:i.iconfont)||u.iconfontSvgUrl,t.id=`${u.prefix}-icon`,x.appendHandler(t)}else{const t=document.createElement("link");t.rel="stylesheet",t.href=((a=u.configOption.editorExtensions)==null?void 0:a.iconfontClass)||u.iconfontClassUrl,t.id=`${u.prefix}-icon-class`,x.appendHandler(t)}})},ke=e=>{var m,s,d,o,f,w;const{noPrettier:i,noUploadImg:a}=e,{editorExtensions:t}=u.configOption,n=i||!!((s=(m=u.configOption.editorExtensions)==null?void 0:m.prettier)!=null&&s.prettierInstance),l=i||!!((o=(d=u.configOption.editorExtensions)==null?void 0:d.prettier)!=null&&o.parserMarkdownInstance),r=a||!!((w=(f=u.configOption.editorExtensions)==null?void 0:f.cropper)!=null&&w.instance);c.onMounted(()=>{var C,y,k,I;const b=document.createElement("script"),h=document.createElement("script");b.src=((C=t==null?void 0:t.prettier)==null?void 0:C.standaloneJs)||u.prettierUrl.main,b.id=`${u.prefix}-prettier`,h.src=((y=t==null?void 0:t.prettier)==null?void 0:y.parserMarkdownJs)||u.prettierUrl.markdown,h.id=`${u.prefix}-prettierMD`;const v=document.createElement("link");v.rel="stylesheet",v.href=((k=t==null?void 0:t.cropper)==null?void 0:k.css)||u.cropperUrl.css,v.id=`${u.prefix}-cropperCss`;const g=document.createElement("script");g.src=((I=t==null?void 0:t.cropper)==null?void 0:I.js)||u.cropperUrl.js,g.id=`${u.prefix}-cropper`,r||(x.appendHandler(v),x.appendHandler(g)),n||x.appendHandler(b),l||x.appendHandler(h)}),L(e)},Ce=(e,i)=>{const{editorId:a}=e;c.onMounted(()=>{p.bus.on(a,{name:p.ERROR_CATCHER,callback:t=>{e.onError instanceof Function?e.onError(t):i.emit("onError",t)}})})},Ee=(e,i)=>{const{editorId:a}=e,t=c.reactive({pageFullscreen:e.pageFullscreen,fullscreen:!1,preview:e.preview,htmlPreview:e.preview?!1:e.htmlPreview}),n=(m,s)=>{t[m]=s===void 0?!t[m]:s,m==="preview"&&t.preview?t.htmlPreview=!1:m==="htmlPreview"&&t.htmlPreview&&(t.preview=!1)};let l="";const r=()=>{t.pageFullscreen||t.fullscreen?document.body.style.overflow="hidden":document.body.style.overflow=l};return c.watch(()=>[t.pageFullscreen,t.fullscreen],r),c.onMounted(()=>{p.bus.on(a,{name:p.UPLOAD_IMAGE,callback(m,s){const d=o=>{p.bus.emit(a,p.REPLACE,"image",{desc:"",urls:o}),s&&s()};e.onUploadImg?e.onUploadImg(m,d):i.emit("onUploadImg",m,d)}}),l=document.body.style.overflow,r()}),[t,n]},$e=e=>{const{editorId:i}=e,a=c.ref(!1);return c.onMounted(()=>{p.bus.on(i,{name:p.CHANGE_CATALOG_VISIBLE,callback:n=>{n===void 0?a.value=!a.value:a.value=n}})}),c.computed(()=>!e.toolbarsExclude.includes("catalog")&&e.toolbars.includes("catalog")&&a.value)},Ie=(e,i,a,t,n,l)=>{const{editorId:r}=e;c.watch(()=>t.pageFullscreen,s=>{p.bus.emit(r,p.PAGE_FULL_SCREEN_CHANGED,s)}),c.watch(()=>t.fullscreen,s=>{p.bus.emit(r,p.FULL_SCREEN_CHANGED,s)}),c.watch(()=>t.preview,s=>{p.bus.emit(r,p.PREVIEW_CHANGED,s)}),c.watch(()=>t.htmlPreview,s=>{p.bus.emit(r,p.HTML_PREVIEW_CHANGED,s)}),c.watch(a,s=>{p.bus.emit(r,p.CATALOG_VISIBLE_CHANGED,s)});const m={on(s,d){switch(s){case"pageFullscreen":{p.bus.on(r,{name:p.PAGE_FULL_SCREEN_CHANGED,callback(o){d(o)}});break}case"fullscreen":{p.bus.on(r,{name:p.FULL_SCREEN_CHANGED,callback(o){d(o)}});break}case"preview":{p.bus.on(r,{name:p.PREVIEW_CHANGED,callback(o){d(o)}});break}case"htmlPreview":{p.bus.on(r,{name:p.HTML_PREVIEW_CHANGED,callback(o){d(o)}});break}case"catalog":{p.bus.on(r,{name:p.CATALOG_VISIBLE_CHANGED,callback(o){d(o)}});break}}},togglePageFullscreen(s){n("pageFullscreen",s)},toggleFullscreen(s){p.bus.emit(r,p.CHANGE_FULL_SCREEN,s)},togglePreview(s){n("preview",s)},toggleHtmlPreview(s){n("htmlPreview",s)},toggleCatalog(s){p.bus.emit(r,p.CHANGE_CATALOG_VISIBLE,s)},triggerSave(){p.bus.emit(r,p.ON_SAVE)},insert(s){p.bus.emit(r,p.REPLACE,"universal",{generate:s})},focus(s){var d;(d=l.value)==null||d.focus(s)},rerender(){p.bus.emit(r,p.RERENDER)},getSelectedText(){var s;return(s=l.value)==null?void 0:s.getSelectedText()},resetHistory(){var s;(s=l.value)==null||s.resetHistory()}};i.expose(m)},xe=e=>e,N={modelValue:{type:String,default:""},theme:{type:String,default:"light"},class:{type:String,default:""},language:{type:String,default:"zh-CN"},onHtmlChanged:{type:Function},onGetCatalog:{type:Function},editorId:{type:String,default:u.defaultEditorId},showCodeRowNumber:{type:Boolean,default:!1},previewTheme:{type:String,default:"default"},style:{type:Object,default:()=>({})},mdHeadingId:{type:Function,default:xe},sanitize:{type:Function,default:e=>e},noMermaid:{type:Boolean,default:!1},noKatex:{type:Boolean,default:!1},codeTheme:{type:String,default:"atom"},noIconfont:{type:Boolean},formatCopiedText:{type:Function,default:e=>e},codeStyleReverse:{type:Boolean,default:!0},codeStyleReverseList:{type:Array,default:["default","mk-cute"]},noHighlight:{type:Boolean,default:!1},noImgZoomIn:{type:Boolean,default:!1},customIcon:{type:Object,default:{}},sanitizeMermaid:{type:Function,default:e=>Promise.resolve(e)}},Se={...N,onChange:{type:Function},onSave:{type:Function},onUploadImg:{type:Function},pageFullscreen:{type:Boolean,default:!1},preview:{type:Boolean,default:!0},htmlPreview:{type:Boolean,default:!1},toolbars:{type:Array,default:u.allToolbar},toolbarsExclude:{type:Array,default:[]},noPrettier:{type:Boolean,default:!1},tabWidth:{type:Number,default:2},tableShape:{type:Array,default:()=>[6,4]},placeholder:{type:String,default:""},defToolbars:{type:[String,Object]},onError:{type:Function},footers:{type:Array,default:u.allFooter},scrollAuto:{type:Boolean,default:!0},defFooters:{type:[String,Object]},noUploadImg:{type:Boolean},autoFocus:{type:Boolean},disabled:{type:Boolean},readOnly:{type:Boolean},maxLength:{type:Number},autoDetectCode:{type:Boolean},onBlur:{type:Function},onFocus:{type:Function},completions:{type:Array},showToolbarName:{type:Boolean,default:!1},onInput:{type:Function},onDrop:{type:Function},inputBoxWitdh:{type:String,default:"50%"},onInputBoxWitdhChange:{type:Function}},B=["onHtmlChanged","onGetCatalog"],_e=[...B,"onChange","onSave","onUploadImg","onError","update:modelValue","onBlur","onFocus","onInput","onDrop","onInputBoxWitdhChange"],He=(e,i)=>{const{editorId:a}=e,t={rerender(){p.bus.emit(a,p.RERENDER)}};i.expose(t)},Pe=c.defineComponent({name:"MdPreview",props:N,emits:B,setup(e,i){const{editorId:a,noKatex:t,noMermaid:n,noHighlight:l}=e;return F(e),L(e),He(e,i),c.onBeforeUnmount(()=>{p.bus.clear(a)}),()=>c.createVNode("div",{id:a,class:[u.prefix,e.class,e.theme==="dark"&&`${u.prefix}-dark`,`${u.prefix}-previewOnly`],style:e.style},[c.createVNode(R,{modelValue:e.modelValue,onHtmlChanged:r=>{e.onHtmlChanged?e.onHtmlChanged(r):i.emit("onHtmlChanged",r)},onGetCatalog:r=>{e.onGetCatalog?e.onGetCatalog(r):i.emit("onGetCatalog",r)},mdHeadingId:e.mdHeadingId,noMermaid:n,sanitize:e.sanitize,noKatex:t,formatCopiedText:e.formatCopiedText,noHighlight:l,noImgZoomIn:e.noImgZoomIn,previewOnly:!0,sanitizeMermaid:e.sanitizeMermaid},null)])}}),H=Pe;H.install=e=>(e.component(H.name,H),e);exports.ContentPreview=R;exports.MdPreview=H;exports.contentProps=ye;exports.editorEmits=_e;exports.editorProps=Se;exports.useCatalog=$e;exports.useConfig=Ee;exports.useErrorCatcher=Ce;exports.useExpansion=ke;exports.useExpose=Ie;exports.useOnSave=be;exports.useProvide=we;
