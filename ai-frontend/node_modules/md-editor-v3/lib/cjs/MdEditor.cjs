"use strict";var ht=Object.defineProperty;var vt=(e,l,o)=>l in e?ht(e,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[l]=o;var q=(e,l,o)=>(vt(e,typeof l!="symbol"?l+"":l,o),o);const t=require("vue"),a=require("./chunks/config.cjs"),le=require("@vavt/util"),Z=require("./chunks/index2.cjs"),d=require("./chunks/index4.cjs"),pt=require("./chunks/dom.cjs"),$=require("./chunks/index3.cjs"),se=require("codemirror"),ae=require("@codemirror/view"),Ct=require("@codemirror/language-data"),kt=require("@codemirror/lang-markdown"),T=require("@codemirror/state"),G=require("@codemirror/commands"),re=require("@codemirror/language"),c=require("@lezer/highlight"),xt=require("@codemirror/autocomplete"),P=require("./chunks/index.cjs"),bt=require("./MdCatalog.cjs"),et=require("./chunks/vue-tsx.cjs"),$t=require("./NormalToolbar.cjs"),Nt=require("./ModalToolbar.cjs");require("medium-zoom");require("copy-to-clipboard");require("markdown-it");require("markdown-it-image-figures");require("markdown-it-task-lists");require("lru-cache");const Vt=t.defineComponent({setup(){return()=>t.createVNode("div",{class:`${a.prefix}-divider`},null)}}),wt={noPrettier:{type:Boolean},toolbars:{type:Array,default:()=>[]},toolbarsExclude:{type:Array,default:()=>[]},setting:{type:Object,default:()=>({})},screenfull:{type:Object,default:null},screenfullJs:{type:String,default:""},updateSetting:{type:Function,default:()=>{}},tableShape:{type:Array,default:()=>[6,4]},defToolbars:{type:Object},noUploadImg:{type:Boolean},showToolbarName:{type:Boolean}},yt=e=>{var m,s,g,x;const l=t.inject("editorId");let o=(s=(m=a.configOption.editorExtensions)==null?void 0:m.screenfull)==null?void 0:s.instance;const r=(x=(g=a.configOption.editorExtensions)==null?void 0:g.screenfull)==null?void 0:x.js,i=t.ref(!1),n=p=>{if(!o){d.bus.emit(l,d.ERROR_CATCHER,{name:"fullscreen",message:"fullscreen is undefined"});return}o.isEnabled?(i.value=!0,(p===void 0?!o.isFullscreen:p)?o.request():o.exit()):console.error("browser does not support screenfull!")},h=()=>{o&&o.isEnabled&&o.on("change",()=>{(i.value||e.setting.fullscreen)&&(i.value=!1,e.updateSetting("fullscreen"))})},b=()=>{o=window.screenfull,h()};return t.onMounted(()=>{if(h(),!o){const p=document.createElement("script");p.src=r||a.screenfullUrl,p.onload=b,p.id=`${a.prefix}-screenfull`,pt.appendHandler(p,"screenfull")}}),t.onMounted(()=>{d.bus.on(l,{name:d.CHANGE_FULL_SCREEN,callback:n})}),{fullscreenHandler:n}},Tt={tableShape:{type:Array,default:()=>[6,4]},onSelected:{type:Function,default:()=>{}}},Et=t.defineComponent({name:"TableShape",props:Tt,setup(e){const l=t.reactive({x:-1,y:-1});return()=>t.createVNode("div",{class:`${a.prefix}-table-shape`,onMouseleave:()=>{l.x=-1,l.y=-1}},[new Array(e.tableShape[1]).fill("").map((o,r)=>t.createVNode("div",{class:`${a.prefix}-table-shape-row`,key:`table-shape-row-${r}`},[new Array(e.tableShape[0]).fill("").map((i,n)=>t.createVNode("div",{class:`${a.prefix}-table-shape-col`,key:`table-shape-col-${n}`,onMouseenter:()=>{l.x=r,l.y=n},onClick:()=>{e.onSelected(l)}},[t.createVNode("div",{class:[`${a.prefix}-table-shape-col-default`,r<=l.x&&n<=l.y&&`${a.prefix}-table-shape-col-include`]},null)]))]))])}}),St=Et,At={type:{type:String,default:"link"},visible:{type:Boolean,default:!1},onCancel:{type:Function,default:()=>{}},onOk:{type:Function,default:()=>{}}},It=t.defineComponent({props:At,setup(e){const l=t.inject("usedLanguageText"),o=t.inject("editorId"),r=t.computed(()=>{var n,h;switch(e.type){case"link":return(n=l.value.linkModalTips)==null?void 0:n.linkTitle;case"image":return(h=l.value.linkModalTips)==null?void 0:h.imageTitle;default:return""}}),i=t.reactive({desc:"",url:""});return t.watch(()=>e.visible,n=>{n||setTimeout(()=>{i.desc="",i.url=""},200)}),()=>t.createVNode($.MdModal,{title:r.value,visible:e.visible,onClose:e.onCancel},{default:()=>{var n,h,b,m,s;return[t.createVNode("div",{class:`${a.prefix}-form-item`},[t.createVNode("label",{class:`${a.prefix}-label`,for:`link-desc-${o}`},[(n=l.value.linkModalTips)==null?void 0:n.descLabel]),t.createVNode("input",{placeholder:(h=l.value.linkModalTips)==null?void 0:h.descLabelPlaceHolder,class:`${a.prefix}-input`,id:`link-desc-${o}`,type:"text",value:i.desc,onChange:g=>{i.desc=g.target.value},autocomplete:"off"},null)]),t.createVNode("div",{class:`${a.prefix}-form-item`},[t.createVNode("label",{class:`${a.prefix}-label`,for:`link-url-${o}`},[(b=l.value.linkModalTips)==null?void 0:b.urlLabel]),t.createVNode("input",{placeholder:(m=l.value.linkModalTips)==null?void 0:m.urlLabelPlaceHolder,class:`${a.prefix}-input`,id:`link-url-${o}`,type:"text",value:i.url,onChange:g=>{i.url=g.target.value},autocomplete:"off"},null)]),t.createVNode("div",{class:`${a.prefix}-form-item`},[t.createVNode("button",{class:[`${a.prefix}-btn`,`${a.prefix}-btn-row`],type:"button",onClick:()=>{e.onOk(i),i.desc="",i.url=""}},[(s=l.value.linkModalTips)==null?void 0:s.buttonOK])])]}})}}),Lt={visible:{type:Boolean,default:!1},onCancel:{type:Function,default:()=>{}},onOk:{type:Function,default:()=>{}}},Mt=t.defineComponent({props:Lt,setup(e){var g,x,p;const l=t.inject("usedLanguageText"),o=t.inject("editorId");let r=(p=(x=(g=a.configOption)==null?void 0:g.editorExtensions)==null?void 0:x.cropper)==null?void 0:p.instance;const i=t.ref(),n=t.ref(),h=t.ref(),b=t.reactive({cropperInited:!1,imgSelected:!1,imgSrc:"",isFullscreen:!1});let m=null;t.watch(()=>e.visible,()=>{e.visible&&!b.cropperInited&&(r=r||window.Cropper,i.value.onchange=()=>{if(!r){d.bus.emit(o,d.ERROR_CATCHER,{name:"Cropper",message:"Cropper is undefined"});return}const k=i.value.files||[];if(b.imgSelected=!0,(k==null?void 0:k.length)>0){const f=new FileReader;f.onload=v=>{b.imgSrc=v.target.result,t.nextTick(()=>{m=new r(n.value,{viewMode:2,preview:`.${a.prefix}-clip-preview-target`})})},f.readAsDataURL(k[0])}})}),t.watch(()=>[b.imgSelected],()=>{h.value.style=""}),t.watch(()=>b.isFullscreen,()=>{t.nextTick(()=>{m==null||m.destroy(),h.value.style="",n.value&&(m=new r(n.value,{viewMode:2,preview:`.${a.prefix}-clip-preview-target`}))})});const s=()=>{m.clear(),m.destroy(),m=null,i.value.value="",b.imgSelected=!1};return()=>{var k;return t.createVNode($.MdModal,{class:`${a.prefix}-modal-clip`,title:(k=l.value.clipModalTips)==null?void 0:k.title,visible:e.visible,onClose:e.onCancel,showAdjust:!0,isFullscreen:b.isFullscreen,onAdjust:f=>{b.isFullscreen=f},width:"668px",height:"421px"},{default:()=>{var f,v;return[t.createVNode("div",{class:`${a.prefix}-form-item ${a.prefix}-clip`},[t.createVNode("div",{class:`${a.prefix}-clip-main`},[b.imgSelected?t.createVNode("div",{class:`${a.prefix}-clip-cropper`},[t.createVNode("img",{src:b.imgSrc,ref:n,style:{display:"none"},alt:""},null),t.createVNode("div",{class:`${a.prefix}-clip-delete`,onClick:s},[t.createVNode($.Icon,{name:"delete"},null)])]):t.createVNode("div",{class:`${a.prefix}-clip-upload`,onClick:()=>{i.value.click()}},[t.createVNode($.Icon,{name:"upload"},null)])]),t.createVNode("div",{class:`${a.prefix}-clip-preview`},[t.createVNode("div",{class:`${a.prefix}-clip-preview-target`,ref:h},null)])]),t.createVNode("div",{class:`${a.prefix}-form-item`},[t.createVNode("button",{class:`${a.prefix}-btn`,type:"button",onClick:()=>{if(m){const u=m.getCroppedCanvas();d.bus.emit(o,d.UPLOAD_IMAGE,[d.base642File(u.toDataURL("image/png"))],e.onOk),s()}}},[((f=l.value.clipModalTips)==null?void 0:f.buttonUpload)||((v=l.value.linkModalTips)==null?void 0:v.buttonOK)])]),t.createVNode("input",{ref:i,accept:"image/*",type:"file",multiple:!1,style:{display:"none"}},null)]}})}}}),Rt={type:{type:String,default:"link"},linkVisible:{type:Boolean,default:!1},clipVisible:{type:Boolean,default:!1},onCancel:{type:Function,default:()=>{}},onOk:{type:Function,default:()=>{}}},Dt=t.defineComponent({props:Rt,setup(e){return()=>t.createVNode(t.Fragment,null,[t.createVNode(It,{type:e.type,visible:e.linkVisible,onOk:e.onOk,onCancel:e.onCancel},null),t.createVNode(Mt,{visible:e.clipVisible,onOk:e.onOk,onCancel:e.onCancel},null)])}}),Ht=t.defineComponent({name:"MDEditorToolbar",props:wt,setup(e){const l=t.inject("editorId"),o=t.inject("usedLanguageText"),r=t.inject("theme"),i=t.inject("language"),{fullscreenHandler:n}=yt(e),h=`${l}-toolbar-wrapper`,b=t.ref(),m=t.reactive({title:!1,catalog:!1,image:!1,table:!1,mermaid:!1,katex:!1}),s=(u,C)=>{d.bus.emit(l,d.REPLACE,u,C)},g=t.reactive({type:"link",linkVisible:!1,clipVisible:!1}),x=t.ref();t.onMounted(()=>{d.bus.on(l,{name:d.OPEN_MODALS,callback(u){g.type=u,g.linkVisible=!0}})});const p=t.computed(()=>{const u=e.toolbars.filter(y=>!e.toolbarsExclude.includes(y)),C=u.indexOf("="),V=C===-1?u:u.slice(0,C+1),w=C===-1?[]:u.slice(C,Number.MAX_SAFE_INTEGER);return[V,w]}),k=t.ref(),f=()=>{d.bus.emit(l,d.UPLOAD_IMAGE,Array.from(k.value.files||[])),k.value.value=""};t.onMounted(()=>{k.value.addEventListener("change",f)});const v=u=>{var C,V,w,y,A,X,Y,E,S,F,B,R,L,M,D,W,_,ne,J,U,j,Q,z,H,O,ee,ie,ge,be,he,ve,pe,Ce,ke,xe,$e,Ne,Ve,we,ye,Te,Ee,Se,Ae,Ie,Le,Me,Re,De,He,Oe,Pe,Be,Fe,qe,We,_e,je,ze,Ge,Ue,Ke,Ze,Xe,Ye,Je,Qe;if(a.allToolbar.includes(u))switch(u){case"-":return t.createVNode(Vt,null,null);case"bold":return t.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(C=o.value.toolbarTips)==null?void 0:C.bold,onClick:()=>{s("bold")}},[t.createVNode($.Icon,{name:"bold"},null),e.showToolbarName&&t.createVNode("div",{class:`${a.prefix}-toolbar-item-name`},[(V=o.value.toolbarTips)==null?void 0:V.bold])]);case"underline":return t.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(w=o.value.toolbarTips)==null?void 0:w.underline,onClick:()=>{s("underline")}},[t.createVNode($.Icon,{name:"underline"},null),e.showToolbarName&&t.createVNode("div",{class:`${a.prefix}-toolbar-item-name`},[(y=o.value.toolbarTips)==null?void 0:y.underline])]);case"italic":return t.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(A=o.value.toolbarTips)==null?void 0:A.italic,onClick:()=>{s("italic")}},[t.createVNode($.Icon,{name:"italic"},null),e.showToolbarName&&t.createVNode("div",{class:`${a.prefix}-toolbar-item-name`},[(X=o.value.toolbarTips)==null?void 0:X.italic])]);case"strikeThrough":return t.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(Y=o.value.toolbarTips)==null?void 0:Y.strikeThrough,onClick:()=>{s("strikeThrough")}},[t.createVNode($.Icon,{name:"strike-through"},null),e.showToolbarName&&t.createVNode("div",{class:`${a.prefix}-toolbar-item-name`},[(E=o.value.toolbarTips)==null?void 0:E.strikeThrough])]);case"title":return t.createVNode(Z.Dropdown,{relative:`#${h}`,visible:m.title,onChange:N=>{m.title=N},overlay:t.createVNode("ul",{class:`${a.prefix}-menu`,onClick:()=>{m.title=!1}},[t.createVNode("li",{class:`${a.prefix}-menu-item ${a.prefix}-menu-item-title`,onClick:()=>{s("h1")}},[(S=o.value.titleItem)==null?void 0:S.h1]),t.createVNode("li",{class:`${a.prefix}-menu-item ${a.prefix}-menu-item-title`,onClick:()=>{s("h2")}},[(F=o.value.titleItem)==null?void 0:F.h2]),t.createVNode("li",{class:`${a.prefix}-menu-item ${a.prefix}-menu-item-title`,onClick:()=>{s("h3")}},[(B=o.value.titleItem)==null?void 0:B.h3]),t.createVNode("li",{class:`${a.prefix}-menu-item ${a.prefix}-menu-item-title`,onClick:()=>{s("h4")}},[(R=o.value.titleItem)==null?void 0:R.h4]),t.createVNode("li",{class:`${a.prefix}-menu-item ${a.prefix}-menu-item-title`,onClick:()=>{s("h5")}},[(L=o.value.titleItem)==null?void 0:L.h5]),t.createVNode("li",{class:`${a.prefix}-menu-item ${a.prefix}-menu-item-title`,onClick:()=>{s("h6")}},[(M=o.value.titleItem)==null?void 0:M.h6])])},{default:()=>{var N,I;return[t.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(N=o.value.toolbarTips)==null?void 0:N.title},[t.createVNode($.Icon,{name:"title"},null),e.showToolbarName&&t.createVNode("div",{class:`${a.prefix}-toolbar-item-name`},[(I=o.value.toolbarTips)==null?void 0:I.title])])]}});case"sub":return t.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(D=o.value.toolbarTips)==null?void 0:D.sub,onClick:()=>{s("sub")}},[t.createVNode($.Icon,{name:"sub"},null),e.showToolbarName&&t.createVNode("div",{class:`${a.prefix}-toolbar-item-name`},[(W=o.value.toolbarTips)==null?void 0:W.sub])]);case"sup":return t.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(_=o.value.toolbarTips)==null?void 0:_.sup,onClick:()=>{s("sup")}},[t.createVNode($.Icon,{name:"sup"},null),e.showToolbarName&&t.createVNode("div",{class:`${a.prefix}-toolbar-item-name`},[(ne=o.value.toolbarTips)==null?void 0:ne.sup])]);case"quote":return t.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(J=o.value.toolbarTips)==null?void 0:J.quote,onClick:()=>{s("quote")}},[t.createVNode($.Icon,{name:"quote"},null),e.showToolbarName&&t.createVNode("div",{class:`${a.prefix}-toolbar-item-name`},[(U=o.value.toolbarTips)==null?void 0:U.quote])]);case"unorderedList":return t.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(j=o.value.toolbarTips)==null?void 0:j.unorderedList,onClick:()=>{s("unorderedList")}},[t.createVNode($.Icon,{name:"unordered-list"},null),e.showToolbarName&&t.createVNode("div",{class:`${a.prefix}-toolbar-item-name`},[(Q=o.value.toolbarTips)==null?void 0:Q.unorderedList])]);case"orderedList":return t.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(z=o.value.toolbarTips)==null?void 0:z.orderedList,onClick:()=>{s("orderedList")}},[t.createVNode($.Icon,{name:"ordered-list"},null),e.showToolbarName&&t.createVNode("div",{class:`${a.prefix}-toolbar-item-name`},[(H=o.value.toolbarTips)==null?void 0:H.orderedList])]);case"task":return t.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(O=o.value.toolbarTips)==null?void 0:O.task,onClick:()=>{s("task")}},[t.createVNode($.Icon,{name:"task"},null),e.showToolbarName&&t.createVNode("div",{class:`${a.prefix}-toolbar-item-name`},[(ee=o.value.toolbarTips)==null?void 0:ee.task])]);case"codeRow":return t.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(ie=o.value.toolbarTips)==null?void 0:ie.codeRow,onClick:()=>{s("codeRow")}},[t.createVNode($.Icon,{name:"code-row"},null),e.showToolbarName&&t.createVNode("div",{class:`${a.prefix}-toolbar-item-name`},[(ge=o.value.toolbarTips)==null?void 0:ge.codeRow])]);case"code":return t.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(be=o.value.toolbarTips)==null?void 0:be.code,onClick:()=>{s("code")}},[t.createVNode($.Icon,{name:"code"},null),e.showToolbarName&&t.createVNode("div",{class:`${a.prefix}-toolbar-item-name`},[(he=o.value.toolbarTips)==null?void 0:he.code])]);case"link":return t.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(ve=o.value.toolbarTips)==null?void 0:ve.link,onClick:()=>{g.type="link",g.linkVisible=!0}},[t.createVNode($.Icon,{name:"link"},null),e.showToolbarName&&t.createVNode("div",{class:`${a.prefix}-toolbar-item-name`},[(pe=o.value.toolbarTips)==null?void 0:pe.link])]);case"image":return e.noUploadImg?t.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(Ce=o.value.toolbarTips)==null?void 0:Ce.image,onClick:()=>{g.type="image",g.linkVisible=!0}},[t.createVNode($.Icon,{name:"image"},null),e.showToolbarName&&t.createVNode("div",{class:`${a.prefix}-toolbar-item-name`},[(ke=o.value.toolbarTips)==null?void 0:ke.image])]):t.createVNode(Z.Dropdown,{relative:`#${h}`,visible:m.image,onChange:N=>{m.image=N},overlay:t.createVNode("ul",{class:`${a.prefix}-menu`,onClick:()=>{m.title=!1}},[t.createVNode("li",{class:`${a.prefix}-menu-item ${a.prefix}-menu-item-image`,onClick:()=>{g.type="image",g.linkVisible=!0}},[(xe=o.value.imgTitleItem)==null?void 0:xe.link]),t.createVNode("li",{class:`${a.prefix}-menu-item ${a.prefix}-menu-item-image`,onClick:()=>{k.value.click()}},[($e=o.value.imgTitleItem)==null?void 0:$e.upload]),t.createVNode("li",{class:`${a.prefix}-menu-item ${a.prefix}-menu-item-image`,onClick:()=>{g.clipVisible=!0}},[(Ne=o.value.imgTitleItem)==null?void 0:Ne.clip2upload])])},{default:()=>{var N,I;return[t.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(N=o.value.toolbarTips)==null?void 0:N.image},[t.createVNode($.Icon,{name:"image"},null),e.showToolbarName&&t.createVNode("div",{class:`${a.prefix}-toolbar-item-name`},[(I=o.value.toolbarTips)==null?void 0:I.image])])]}});case"table":return t.createVNode(Z.Dropdown,{relative:`#${h}`,visible:m.table,onChange:N=>{m.table=N},key:"bar-table",overlay:t.createVNode(St,{tableShape:e.tableShape,onSelected:N=>{s("table",{selectedShape:N})}},null)},{default:()=>{var N,I;return[t.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(N=o.value.toolbarTips)==null?void 0:N.table},[t.createVNode($.Icon,{name:"table"},null),e.showToolbarName&&t.createVNode("div",{class:`${a.prefix}-toolbar-item-name`},[(I=o.value.toolbarTips)==null?void 0:I.table])])]}});case"revoke":return t.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(Ve=o.value.toolbarTips)==null?void 0:Ve.revoke,onClick:()=>{d.bus.emit(l,d.CTRL_Z)}},[t.createVNode($.Icon,{name:"revoke"},null),e.showToolbarName&&t.createVNode("div",{class:`${a.prefix}-toolbar-item-name`},[(we=o.value.toolbarTips)==null?void 0:we.revoke])]);case"next":return t.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(ye=o.value.toolbarTips)==null?void 0:ye.next,onClick:()=>{d.bus.emit(l,d.CTRL_SHIFT_Z)}},[t.createVNode($.Icon,{name:"next"},null),e.showToolbarName&&t.createVNode("div",{class:`${a.prefix}-toolbar-item-name`},[(Te=o.value.toolbarTips)==null?void 0:Te.next])]);case"save":return t.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(Ee=o.value.toolbarTips)==null?void 0:Ee.save,onClick:()=>{d.bus.emit(l,d.ON_SAVE)}},[t.createVNode($.Icon,{name:"baocun"},null),e.showToolbarName&&t.createVNode("div",{class:`${a.prefix}-toolbar-item-name`},[(Se=o.value.toolbarTips)==null?void 0:Se.save])]);case"prettier":return e.noPrettier?"":t.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(Ae=o.value.toolbarTips)==null?void 0:Ae.prettier,onClick:()=>{s("prettier")}},[t.createVNode($.Icon,{name:"prettier"},null),e.showToolbarName&&t.createVNode("div",{class:`${a.prefix}-toolbar-item-name`},[(Ie=o.value.toolbarTips)==null?void 0:Ie.prettier])]);case"pageFullscreen":return!e.setting.fullscreen&&t.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(Le=o.value.toolbarTips)==null?void 0:Le.pageFullscreen,onClick:()=>{e.updateSetting("pageFullscreen")}},[t.createVNode($.Icon,{name:e.setting.pageFullscreen?"suoxiao":"fangda"},null),e.showToolbarName&&t.createVNode("div",{class:`${a.prefix}-toolbar-item-name`},[(Me=o.value.toolbarTips)==null?void 0:Me.pageFullscreen])]);case"fullscreen":return t.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(Re=o.value.toolbarTips)==null?void 0:Re.fullscreen,onClick:()=>{n()}},[t.createVNode($.Icon,{name:e.setting.fullscreen?"fullscreen-exit":"fullscreen"},null),e.showToolbarName&&t.createVNode("div",{class:`${a.prefix}-toolbar-item-name`},[(De=o.value.toolbarTips)==null?void 0:De.fullscreen])]);case"preview":return t.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(He=o.value.toolbarTips)==null?void 0:He.preview,onClick:()=>{e.updateSetting("preview")}},[t.createVNode($.Icon,{name:"preview"},null),e.showToolbarName&&t.createVNode("div",{class:`${a.prefix}-toolbar-item-name`},[(Oe=o.value.toolbarTips)==null?void 0:Oe.preview])]);case"htmlPreview":return t.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(Pe=o.value.toolbarTips)==null?void 0:Pe.htmlPreview,onClick:()=>{e.updateSetting("htmlPreview")}},[t.createVNode($.Icon,{name:"coding"},null),e.showToolbarName&&t.createVNode("div",{class:`${a.prefix}-toolbar-item-name`},[(Be=o.value.toolbarTips)==null?void 0:Be.htmlPreview])]);case"catalog":return t.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(Fe=o.value.toolbarTips)==null?void 0:Fe.catalog,onClick:()=>{d.bus.emit(l,d.CHANGE_CATALOG_VISIBLE)},key:"bar-catalog"},[t.createVNode($.Icon,{name:"catalog"},null),e.showToolbarName&&t.createVNode("div",{class:`${a.prefix}-toolbar-item-name`},[(qe=o.value.toolbarTips)==null?void 0:qe.catalog])]);case"github":return t.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(We=o.value.toolbarTips)==null?void 0:We.github,onClick:()=>le.linkTo("https://github.com/imzbf/md-editor-v3")},[t.createVNode($.Icon,{name:"github"},null),e.showToolbarName&&t.createVNode("div",{class:`${a.prefix}-toolbar-item-name`},[(_e=o.value.toolbarTips)==null?void 0:_e.github])]);case"mermaid":return t.createVNode(Z.Dropdown,{relative:`#${h}`,visible:m.mermaid,onChange:N=>{m.mermaid=N},overlay:t.createVNode("ul",{class:`${a.prefix}-menu`,onClick:()=>{m.mermaid=!1}},[t.createVNode("li",{class:`${a.prefix}-menu-item ${a.prefix}-menu-item-mermaid`,onClick:()=>{s("flow")}},[(je=o.value.mermaid)==null?void 0:je.flow]),t.createVNode("li",{class:`${a.prefix}-menu-item ${a.prefix}-menu-item-mermaid`,onClick:()=>{s("sequence")}},[(ze=o.value.mermaid)==null?void 0:ze.sequence]),t.createVNode("li",{class:`${a.prefix}-menu-item ${a.prefix}-menu-item-mermaid`,onClick:()=>{s("gantt")}},[(Ge=o.value.mermaid)==null?void 0:Ge.gantt]),t.createVNode("li",{class:`${a.prefix}-menu-item ${a.prefix}-menu-item-mermaid`,onClick:()=>{s("class")}},[(Ue=o.value.mermaid)==null?void 0:Ue.class]),t.createVNode("li",{class:`${a.prefix}-menu-item ${a.prefix}-menu-item-mermaid`,onClick:()=>{s("state")}},[(Ke=o.value.mermaid)==null?void 0:Ke.state]),t.createVNode("li",{class:`${a.prefix}-menu-item ${a.prefix}-menu-item-mermaid`,onClick:()=>{s("pie")}},[(Ze=o.value.mermaid)==null?void 0:Ze.pie]),t.createVNode("li",{class:`${a.prefix}-menu-item ${a.prefix}-menu-item-mermaid`,onClick:()=>{s("relationship")}},[(Xe=o.value.mermaid)==null?void 0:Xe.relationship]),t.createVNode("li",{class:`${a.prefix}-menu-item ${a.prefix}-menu-item-mermaid`,onClick:()=>{s("journey")}},[(Ye=o.value.mermaid)==null?void 0:Ye.journey])]),key:"bar-mermaid"},{default:()=>{var N,I;return[t.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(N=o.value.toolbarTips)==null?void 0:N.mermaid},[t.createVNode($.Icon,{name:"mermaid"},null),e.showToolbarName&&t.createVNode("div",{class:`${a.prefix}-toolbar-item-name`},[(I=o.value.toolbarTips)==null?void 0:I.mermaid])])]}});case"katex":return t.createVNode(Z.Dropdown,{relative:`#${h}`,visible:m.katex,onChange:N=>{m.katex=N},overlay:t.createVNode("ul",{class:`${a.prefix}-menu`,onClick:()=>{m.katex=!1}},[t.createVNode("li",{class:`${a.prefix}-menu-item ${a.prefix}-menu-item-katex`,onClick:()=>{s("katexInline")}},[(Je=o.value.katex)==null?void 0:Je.inline]),t.createVNode("li",{class:`${a.prefix}-menu-item ${a.prefix}-menu-item-katex`,onClick:()=>{s("katexBlock")}},[(Qe=o.value.katex)==null?void 0:Qe.block])]),key:"bar-katex"},{default:()=>{var N,I;return[t.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(N=o.value.toolbarTips)==null?void 0:N.katex},[t.createVNode($.Icon,{name:"formula"},null),e.showToolbarName&&t.createVNode("div",{class:`${a.prefix}-toolbar-item-name`},[(I=o.value.toolbarTips)==null?void 0:I.katex])])]}})}else if(e.defToolbars instanceof Array){const N=e.defToolbars[u];return N?t.cloneVNode(N,{theme:r.value,language:i.value,insert(ue){d.bus.emit(l,d.REPLACE,"universal",{generate:ue})}}):""}else if(e.defToolbars&&e.defToolbars.children instanceof Array){const N=e.defToolbars.children[u];return N?t.cloneVNode(N,{theme:r.value,language:i.value,insert(ue){d.bus.emit(l,d.REPLACE,"universal",{generate:ue})}}):""}else return""};return t.watch(()=>e.toolbars,()=>{t.nextTick(()=>{b.value&&le.draggingScroll(b.value)})},{immediate:!0}),()=>{const u=p.value[0].map(V=>v(V)),C=p.value[1].map(V=>v(V));return t.createVNode(t.Fragment,null,[e.toolbars.length>0&&t.createVNode("div",{class:`${a.prefix}-toolbar-wrapper`,ref:b,id:h},[t.createVNode("div",{class:[`${a.prefix}-toolbar`,e.showToolbarName&&`${a.prefix}-stn`]},[t.createVNode("div",{class:`${a.prefix}-toolbar-left`,ref:x},[u]),t.createVNode("div",{class:`${a.prefix}-toolbar-right`},[C])])]),t.createVNode("input",{ref:k,accept:"image/*",type:"file",multiple:!0,style:{display:"none"}},null),t.createVNode(Dt,{linkVisible:g.linkVisible,clipVisible:g.clipVisible,type:g.type,onCancel:()=>{g.linkVisible=!1,g.clipVisible=!1},onOk:V=>{V&&s(g.type,{desc:V.desc,url:V.url}),g.linkVisible=!1,g.clipVisible=!1}},null)])}}}),Ot=(e,l)=>{const o=le.debounce(()=>{e.removeEventListener("scroll",r),e.addEventListener("scroll",r),l.removeEventListener("scroll",r),l.addEventListener("scroll",r)},50),r=i=>{const n=e.clientHeight,h=l.clientHeight,b=e.scrollHeight,m=l.scrollHeight,s=(b-n)/(m-h);i.target===e?(l.removeEventListener("scroll",r),l.scrollTo({top:e.scrollTop/s}),o()):(e.removeEventListener("scroll",r),e.scrollTo({top:l.scrollTop*s}),o())};return[()=>{o().finally(()=>{e.dispatchEvent(new Event("scroll"))})},()=>{e.removeEventListener("scroll",r),l.removeEventListener("scroll",r)}]},Pt=(e,l,o)=>{const{view:r}=o,i=le.createSmoothScroll(),n=p=>r.lineBlockAt(r.state.doc.line(p).from).top,h=p=>r.lineBlockAt(r.state.doc.line(p).from).height;let b=[];const m=()=>{b=[];const p=Array.from(l.querySelectorAll("[data-line]")).map(u=>Number(u.dataset.line)+1),{lines:k}=r.state.doc;let f=1,v=p.shift()??k;for(let u=1;u<=k;u++)u===v&&(f=u,v=p.shift()||k+1),b.push({start:f,end:v-1})};let s=0,g=0;const x=le.throttle(p=>{var C,V,w,y,A,X,Y;if(!((C=l.firstElementChild)!=null&&C.firstElementChild))return;const k=r.lineBlockAtHeight(r.scrollDOM.scrollTop),{number:f}=r.state.doc.lineAt(k.from);if(f>b.length||r.state.doc.lines<b[b.length-1].end)return;let v=+getComputedStyle(l).paddingTop.replace("px","");const u=+getComputedStyle(l).paddingBottom.replace("px","");if(p.target===e){if(g!==0)return;s++;const E=b[f-1];let S=n(E.end)+h(E.end),F=0;const B=n(E.start),R=l.querySelector(`[data-line="${E.start-1}"]`)||((V=l.firstElementChild)==null?void 0:V.firstElementChild),L=l.querySelector(`[data-line="${E.end}"]`)||((w=l.lastElementChild)==null?void 0:w.lastElementChild);let M=0,D=0;B===0?R===L?(v=0,S=r.contentDOM.offsetHeight-r.scrollDOM.offsetHeight,F=r.scrollDOM.scrollTop/S,M=L.offsetTop+L.offsetHeight-l.clientHeight):(F=r.scrollDOM.scrollTop/S,M=L.offsetTop):S>r.scrollDOM.scrollHeight-r.scrollDOM.clientHeight?(F=(r.scrollDOM.scrollTop-B)/(r.scrollDOM.scrollHeight-r.scrollDOM.clientHeight-B),D=R.offsetTop,M=l.scrollHeight-l.clientHeight-D+10):(F=(r.scrollDOM.scrollTop-B)/(S-B),D=R.offsetTop,M=L.offsetTop-D);const W=D-v+M*F;i(l,W,()=>{s--})}else{if(s!==0)return;g++;const E=Array.from(l.querySelectorAll("[data-line]")),S=l.scrollTop,F=l.scrollHeight;let B=E.length===0?1:Math.ceil(Number(E[E.length-1].dataset.line)*(S/F)),R=(y=l.firstElementChild)==null?void 0:y.firstElementChild;for(let H=B;H>=0;H--){const O=l.querySelector(`[data-line="${H}"]`);if(O&&O.offsetTop<=S){R=O,B=H;break}}let L=(A=l.firstElementChild)==null?void 0:A.firstElementChild,M=(X=l.firstElementChild)==null?void 0:X.lastElementChild;for(;E.length>0;){const H=E.indexOf(R);if(H+1>=E.length)break;const O=E[H+1];if(H===-1){M=O;break}const ee=R.offsetTop;if(ee>S){if(H===0){L=R,M=O;break}R=E[H-1];continue}const ie=O.offsetTop;if(ee<=S&&ie>S){L=R,M=O;break}R=O}const D=L.offsetTop;let W=M.offsetTop,_=0;const{start:ne,end:J}=b[Number(L.dataset.line||0)],U=n(ne);let j=n(J);const Q=h(J);let z=0;L===((Y=l.firstElementChild)==null?void 0:Y.firstElementChild)?(L===M?(W=M.offsetHeight-l.offsetHeight+v+u,z=r.contentDOM.offsetHeight-r.scrollDOM.offsetHeight):z=j+Q-U,_=Math.max(S/W,0)):j>r.scrollDOM.scrollHeight-r.scrollDOM.clientHeight?(_=Math.max((S-D)/(l.scrollHeight-D-l.clientHeight),0),j=n(r.state.doc.lines)+h(r.state.doc.lines),z=8+j-U-e.clientHeight):(_=Math.max((S-D)/(W-D),0),z=j+Q-U),i(e,U+z*_,()=>{g--})}},10);return[()=>{m(),e.addEventListener("scroll",x),l.addEventListener("scroll",x),e.dispatchEvent(new Event("scroll"))},()=>{b=[],e.removeEventListener("scroll",x),l.removeEventListener("scroll",x)}]},Bt=(e,l,o)=>{const r=t.inject("editorId");let i=()=>{},n=()=>{};const h=()=>{i();const b=document.querySelector(`#${r} .cm-scroller`),m=document.querySelector(`[id="${r}-preview-wrapper"][data-show="true"]`),s=document.querySelector(`[id="${r}-html-wrapper"][data-show="true"]`);(m||s)&&([n,i]=(m?Pt:Ot)(b,m||s,o.value)),e.scrollAuto&&n()};t.watch([l,t.toRef(e.setting,"preview"),t.toRef(e.setting,"htmlPreview"),t.toRef(e.setting,"fullscreen"),t.toRef(e.setting,"pageFullscreen")],()=>{t.nextTick(h)}),t.watch(()=>e.scrollAuto,b=>{b?n():i()}),t.onMounted(h)},Ft=Bt,qt=(e,l,o)=>{var g,x,p,k,f,v;let r="",i=0,n=0,h=!0,b=!1;const m=l.getSelectedText(),s=(g=a.configOption.editorConfig)==null?void 0:g.mermaidTemplate;if(/^h[1-6]{1}$/.test(e)){const u=e.replace(/^h(\d)/,(C,V)=>new Array(Number(V)).fill("#",0,V).join(""));r=`${u} ${m}`,i=u.length+1}else if(e==="prettier"){const u=window.prettier||((p=(x=a.configOption.editorExtensions)==null?void 0:x.prettier)==null?void 0:p.prettierInstance),C=[((k=window.prettierPlugins)==null?void 0:k.markdown)||((v=(f=a.configOption.editorExtensions)==null?void 0:f.prettier)==null?void 0:v.parserMarkdownInstance)];!u||C[0]===void 0?(d.bus.emit(o.editorId,d.ERROR_CATCHER,{name:"prettier",message:"prettier is undefined"}),r=l.getValue()):r=u.format(l.getValue(),{parser:"markdown",plugins:C}),h=!1,b=!0}else switch(e){case"bold":{r=`**${m}**`,i=2,n=-2;break}case"underline":{r=`<u>${m}</u>`,i=3,n=-4;break}case"italic":{r=`*${m}*`,i=1,n=-1;break}case"strikeThrough":{r=`~~${m}~~`,i=2,n=-2;break}case"sub":{r=`<sub>${m}</sub>`,i=5,n=-6;break}case"sup":{r=`<sup>${m}</sup>`,i=5,n=-6;break}case"codeRow":{r="`"+m+"`",i=1,n=-1;break}case"quote":{r=`> ${m}`,i=2;break}case"orderedList":{r=`1. ${m}`,i=3;break}case"unorderedList":{r=`- ${m}`,i=2;break}case"task":{r=`- [ ] ${m}`,i=6;break}case"code":{const u=o.text||m||"",C=o.mode||"language";r=`\`\`\`${C}
${u}
\`\`\`
`,i=3,n=3+C.length-r.length;break}case"table":{r="|";const{selectedShape:u={x:1,y:1}}=o,{x:C,y:V}=u;for(let w=0;w<=V;w++)r+=" col |";r+=`
|`;for(let w=0;w<=V;w++)r+=" - |";for(let w=0;w<=C;w++){r+=`
|`;for(let y=0;y<=V;y++)r+=" content |"}i=2,n=5-r.length;break}case"link":{const{desc:u,url:C}=o;r=`[${u}](${C})`,h=!1;break}case"image":{const{desc:u,url:C,urls:V}=o;V instanceof Array?r=V.reduce((w,y)=>w+`![${u}](${y})
`,""):r=`![${u}](${C})
`,h=!1;break}case"flow":{r=`\`\`\`mermaid
${(s==null?void 0:s.flow)||`flowchart TD 
  Start --> Stop`}
\`\`\`
`,i=3,n=10-r.length;break}case"sequence":{r=`\`\`\`mermaid
${(s==null?void 0:s.sequence)||`sequenceDiagram
  A->>B: hello!
  B-->>A: hi!
  A-)B: bye!`}
\`\`\`
`,i=3,n=10-r.length;break}case"gantt":{r=`\`\`\`mermaid
${(s==null?void 0:s.gantt)||`gantt
title A Gantt Diagram
dateFormat  YYYY-MM-DD
section Section
A task  :a1, 2014-01-01, 30d
Another task  :after a1, 20d`}
\`\`\`
`,i=3,n=10-r.length;break}case"class":{r=`\`\`\`mermaid
${(s==null?void 0:s.class)||`classDiagram
  class Animal
  Vehicle <|-- Car`}
\`\`\`
`,i=3,n=10-r.length;break}case"state":{r=`\`\`\`mermaid
${(s==null?void 0:s.state)||`stateDiagram-v2
  s1 --> s2`}
\`\`\`
`,i=3,n=10-r.length;break}case"pie":{r=`\`\`\`mermaid
${(s==null?void 0:s.pie)||`pie title Pets adopted by volunteers
  "Dogs" : 386
  "Cats" : 85
  "Rats" : 15`}
\`\`\`
`,i=3,n=10-r.length;break}case"relationship":{r=`\`\`\`mermaid
${(s==null?void 0:s.relationship)||`erDiagram
  CAR ||--o{ NAMED-DRIVER : allows
  PERSON ||--o{ NAMED-DRIVER : is`}
\`\`\`
`,i=3,n=10-r.length;break}case"journey":{r=`\`\`\`mermaid
${(s==null?void 0:s.journey)||`journey
  title My working day
  section Go to work
    Make tea: 5: Me
    Go upstairs: 3: Me
    Do work: 1: Me, Cat
  section Go home
    Go downstairs: 5: Me
    Sit down: 5: Me`}
\`\`\`
`,i=3,n=10-r.length;break}case"katexInline":{r="$$",i=1,n=-1;break}case"katexBlock":{r=`$$

$$
`,i=3,n=-4;break}case"universal":{const{generate:u}=o,C=u(m);r=C.targetValue,h=C.select??!0,i=C.deviationStart||0,n=C.deviationEnd||0}}return{text:r,options:{select:h,deviationStart:i,deviationEnd:n,replaceAll:b}}},Wt="#e5c07b",tt="var(--md-color)",_t="#56b6c2",jt="#ffffff",te="var(--md-color)",ot="#e5c07b",zt="#e5c07b",Gt="var(--md-color)",lt="#d19a66",Ut="#c678dd",Kt="#21252b",Zt="#2c313a",at="var(--md-bk-color)",me="var(--md-bk-color)",Xt="#ceedfa33",rt="#528bff",Yt=ae.EditorView.theme({"&":{color:te,backgroundColor:at},".cm-content":{caretColor:rt},".cm-cursor, .cm-dropCursor":{borderLeftColor:rt},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:Xt},".cm-panels":{backgroundColor:Kt,color:te},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:"#72a1ff59",outline:"1px solid #457dff"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:"#ceedfa33"},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847"},".cm-gutters":{backgroundColor:at,color:te,borderRight:"1px solid",borderColor:"var(--md-border-color)"},".cm-activeLineGutter":{backgroundColor:Zt},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"1px solid var(--md-border-color)",backgroundColor:me},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:me,borderBottomColor:me},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{color:te}}},{dark:!0}),Jt=re.HighlightStyle.define([{tag:c.tags.keyword,color:Ut},{tag:[c.tags.name,c.tags.deleted,c.tags.character,c.tags.propertyName,c.tags.macroName],color:tt},{tag:[c.tags.function(c.tags.variableName),c.tags.labelName],color:zt},{tag:[c.tags.color,c.tags.constant(c.tags.name),c.tags.standard(c.tags.name)],color:lt},{tag:[c.tags.definition(c.tags.name),c.tags.separator],color:te},{tag:[c.tags.typeName,c.tags.className,c.tags.number,c.tags.changed,c.tags.annotation,c.tags.modifier,c.tags.self,c.tags.namespace],color:Wt},{tag:[c.tags.operator,c.tags.operatorKeyword,c.tags.url,c.tags.escape,c.tags.regexp,c.tags.link,c.tags.special(c.tags.string)],color:_t},{tag:[c.tags.meta,c.tags.comment],color:ot},{tag:c.tags.strong,fontWeight:"bold"},{tag:c.tags.emphasis,fontStyle:"italic"},{tag:c.tags.strikethrough,textDecoration:"line-through"},{tag:c.tags.link,color:ot,textDecoration:"underline"},{tag:c.tags.heading,fontWeight:"bold",color:tt},{tag:[c.tags.atom,c.tags.bool,c.tags.special(c.tags.variableName)],color:lt},{tag:[c.tags.processingInstruction,c.tags.string,c.tags.inserted],color:Gt},{tag:c.tags.invalid,color:jt}]),nt=[Yt,re.syntaxHighlighting(Jt)],Qt="#e5c07b",it="#3f4a54",eo="#56b6c2",to="#fff",oe="#3f4a54",st="#2d8cf0",oo="#2d8cf0",lo="#3f4a54",ct="#d19a66",ao="#c678dd",ro="#21252b",no="#ceedfa33",dt="var(--md-bk-color)",fe="var(--md-bk-color)",io="#bad5fa",ut="#3f4a54",so=ae.EditorView.theme({"&":{color:oe,backgroundColor:dt},".cm-content":{caretColor:ut},".cm-cursor, .cm-dropCursor":{borderLeftColor:ut},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:io},".cm-panels":{backgroundColor:ro,color:oe},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:"#72a1ff59",outline:"1px solid #457dff"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:"#ceedfa33"},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847"},".cm-gutters":{backgroundColor:dt,color:oe,borderRight:"1px solid",borderColor:"var(--md-border-color)"},".cm-activeLineGutter":{backgroundColor:no},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"1px solid var(--md-border-color)",backgroundColor:fe},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:fe,borderBottomColor:fe},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{color:oe}}}),co=re.HighlightStyle.define([{tag:c.tags.keyword,color:ao},{tag:[c.tags.name,c.tags.deleted,c.tags.character,c.tags.propertyName,c.tags.macroName],color:it},{tag:[c.tags.function(c.tags.variableName),c.tags.labelName],color:oo},{tag:[c.tags.color,c.tags.constant(c.tags.name),c.tags.standard(c.tags.name)],color:ct},{tag:[c.tags.definition(c.tags.name),c.tags.separator],color:oe},{tag:[c.tags.typeName,c.tags.className,c.tags.number,c.tags.changed,c.tags.annotation,c.tags.modifier,c.tags.self,c.tags.namespace],color:Qt},{tag:[c.tags.operator,c.tags.operatorKeyword,c.tags.url,c.tags.escape,c.tags.regexp,c.tags.link,c.tags.special(c.tags.string)],color:eo},{tag:[c.tags.meta,c.tags.comment],color:st},{tag:c.tags.strong,fontWeight:"bold"},{tag:c.tags.emphasis,fontStyle:"italic"},{tag:c.tags.strikethrough,textDecoration:"line-through"},{tag:c.tags.link,color:st,textDecoration:"underline"},{tag:c.tags.heading,fontWeight:"bold",color:it},{tag:[c.tags.atom,c.tags.bool,c.tags.special(c.tags.variableName)],color:ct},{tag:[c.tags.processingInstruction,c.tags.string,c.tags.inserted],color:lo},{tag:c.tags.invalid,color:to}]),mt=[so,re.syntaxHighlighting(co)],ce=(e,l,o,r,i)=>(n,h,b,m)=>{const s=`${e}${l}`.slice(m-b);n.dispatch(n.state.replaceSelection(`${s}${o}${r}`));const g=b+h.label.length+(i==="title"?o.length:0);n.dispatch({selection:T.EditorSelection.create([T.EditorSelection.range(b+h.label.length+(i==="title"?1:-l.length),g),T.EditorSelection.cursor(g)],1)}),n.focus()},ft=e=>(l,o,r,i)=>{const n=e.slice(i-r);l.dispatch(l.state.replaceSelection(`${n} `))},uo=e=>{const l=o=>{const r=o.matchBefore(/^#+|^-\s*\[*\s*\]*|`+|\[|!\[*|^\|\s?\|?|^\$\$?|!+\s*\w*/);return r===null||r.from==r.to&&o.explicit?null:{from:r.from,options:[...["h1","h2","h3","h4","h5","h6"].map((i,n)=>{const h=new Array(n+1).fill("#").join("");return{label:h,type:"text",apply:ft(h)}}),...["unchecked","checked"].map(i=>{const n=i==="checked"?"- [x]":"- [ ]";return{label:n,type:"text",apply:ft(n)}}),...[["`",""],["```","language"],["```mermaid\n",""]].map(i=>({label:`${i[0]}${i[1]}`,type:"text",apply:ce(i[0],i[1],"",i[0]==="`"?"`":"\n```","type")})),{label:"[]()",type:"text"},{label:"![]()",type:"text"},{label:"| |",type:"text",detail:"table",apply:`| col | col | col |
| - | - | - |
| content | content | content |
| content | content | content |`},{label:"$",type:"text",apply:ce("$","","","$","type")},{label:"$$",type:"text",apply:ce("$$","",`
`,`
$$`,"title")},...["note","abstract","info","tip","success","question","warning","failure","danger","bug","example","quote","hint","caution","error","attention"].map(i=>({label:`!!! ${i}`,type:"text",apply:ce("!!!",` ${i}`," Title",`

!!!`,"title")}))]}};return xt.autocompletion({override:e?[l,...e]:[l]})},gt=uo,K=e=>{const l=new T.Compartment;return r=>(l.get(e.state)?e.dispatch({effects:l.reconfigure(r)}):e.dispatch({effects:T.StateEffect.appendConfig.of(l.of(r))}),!0)};class mo{constructor(l){q(this,"view");q(this,"maxLength",Number.MAX_SAFE_INTEGER);q(this,"toggleTabSize");q(this,"togglePlaceholder");q(this,"setExtensions");q(this,"toggleDisabled");q(this,"toggleReadOnly");q(this,"toggleMaxlength");this.view=l,this.toggleTabSize=K(this.view),this.togglePlaceholder=K(this.view),this.setExtensions=K(this.view),this.toggleDisabled=K(this.view),this.toggleReadOnly=K(this.view),this.toggleMaxlength=K(this.view)}getValue(){return this.view.state.doc.toString()}setValue(l,o=0,r=this.view.state.doc.length){this.view.dispatch({changes:{from:o,to:r,insert:l}})}getSelectedText(){const{from:l,to:o}=this.view.state.selection.main;return this.view.state.sliceDoc(l,o)}replaceSelectedText(l,o={select:!0,deviationStart:0,deviationEnd:0,replaceAll:!1},r){try{if(o.replaceAll){if(this.setValue(l),l.length>this.maxLength)throw new Error("The input text is too long");return}if(this.view.state.doc.length-this.getSelectedText().length+l.length>this.maxLength)throw new Error("The input text is too long");const{from:i}=this.view.state.selection.main;if(this.view.dispatch(this.view.state.replaceSelection(l)),o.select){const n=i+l.length+o.deviationEnd;this.view.dispatch({selection:T.EditorSelection.create([T.EditorSelection.range(i+o.deviationStart,n),T.EditorSelection.cursor(n)],1)})}this.view.focus()}catch(i){if(i.message==="The input text is too long")d.bus.emit(r,d.ERROR_CATCHER,{name:"overlength",message:i.message,data:l});else throw i}}setTabSize(l){this.toggleTabSize([T.EditorState.tabSize.of(l),re.indentUnit.of(" ".repeat(l))])}setPlaceholder(l){this.togglePlaceholder(ae.placeholder(l))}focus(l){if(this.view.focus(),!l)return;let o=0,r=0,i=0;switch(l){case"start":break;case"end":{o=r=i=this.getValue().length;break}default:o=l.rangeAnchor||l.cursorPos,r=l.rangeHead||l.cursorPos,i=l.cursorPos}this.view.dispatch({scrollIntoView:!0,selection:T.EditorSelection.create([T.EditorSelection.range(o,r),T.EditorSelection.cursor(i)],1)})}setDisabled(l){this.toggleDisabled([ae.EditorView.editable.of(!l)])}setReadOnly(l){this.toggleReadOnly([T.EditorState.readOnly.of(l)])}setMaxLength(l){this.maxLength=l,this.toggleMaxlength([T.EditorState.changeFilter.of(o=>o.newDoc.length<=l)])}}const fo=e=>{const l=t.inject("editorId");return r=>{if(!r.clipboardData)return;if(r.clipboardData.files.length>0){const{files:n}=r.clipboardData;d.bus.emit(l,d.UPLOAD_IMAGE,Array.from(n).filter(h=>/image\/.*/.test(h.type))),r.preventDefault();return}if(e.autoDetectCode&&r.clipboardData.types.includes("vscode-editor-data")){const n=JSON.parse(r.clipboardData.getData("vscode-editor-data"));d.bus.emit(l,d.REPLACE,"code",{mode:n.mode,text:r.clipboardData.getData("text/plain")}),r.preventDefault();return}const i=r.clipboardData.getData("text/plain");e.maxlength&&i.length+e.modelValue.length>e.maxlength&&d.bus.emit(l,d.ERROR_CATCHER,{name:"overlength",message:"The input text is too long",data:i})}},go=fo,bo=(e,l)=>{const o={key:"Ctrl-b",mac:"Cmd-b",run:()=>(d.bus.emit(e,d.REPLACE,"bold"),!0)},r={key:"Ctrl-s",mac:"Cmd-s",run:y=>(d.bus.emit(e,d.ON_SAVE,y.state.doc.toString()),!0),shift:()=>(d.bus.emit(e,d.REPLACE,"strikeThrough"),!0)},i={key:"Ctrl-u",mac:"Cmd-u",run:()=>(d.bus.emit(e,d.REPLACE,"underline"),!0),shift:()=>(d.bus.emit(e,d.REPLACE,"unorderedList"),!0)},n={key:"Ctrl-i",mac:"Cmd-i",run:()=>(d.bus.emit(e,d.REPLACE,"italic"),!0),shift:()=>(d.bus.emit(e,d.OPEN_MODALS,"image"),!0)},h={key:"Ctrl-1",mac:"Cmd-1",run:()=>(d.bus.emit(e,d.REPLACE,"h1"),!0)},b={key:"Ctrl-2",mac:"Cmd-2",run:()=>(d.bus.emit(e,d.REPLACE,"h2"),!0)},m={key:"Ctrl-3",mac:"Cmd-3",run:()=>(d.bus.emit(e,d.REPLACE,"h3"),!0)},s={key:"Ctrl-4",mac:"Cmd-4",run:()=>(d.bus.emit(e,d.REPLACE,"h4"),!0)},g={key:"Ctrl-5",mac:"Cmd-5",run:()=>(d.bus.emit(e,d.REPLACE,"h5"),!0)},x={key:"Ctrl-6",mac:"Cmd-6",run:()=>(d.bus.emit(e,d.REPLACE,"h6"),!0)},p={key:"Ctrl-ArrowUp",mac:"Cmd-ArrowUp",run:()=>(d.bus.emit(e,d.REPLACE,"sup"),!0)},k={key:"Ctrl-ArrowDown",mac:"Cmd-ArrowDown",run:()=>(d.bus.emit(e,d.REPLACE,"sub"),!0)},f={key:"Ctrl-o",mac:"Cmd-o",run:()=>(d.bus.emit(e,d.REPLACE,"orderedList"),!0)},v={key:"Ctrl-c",mac:"Cmd-c",shift:()=>(d.bus.emit(e,d.REPLACE,"code"),!0),any(y,A){return(A.ctrlKey||A.metaKey)&&A.altKey&&A.code==="KeyC"?(d.bus.emit(e,d.REPLACE,"codeRow"),!0):!1}},u={key:"Ctrl-l",mac:"Cmd-l",run:()=>(d.bus.emit(e,d.OPEN_MODALS,"link"),!0)},C={key:"Ctrl-f",mac:"Cmd-f",shift:()=>l.noPrettier?!1:(d.bus.emit(e,d.REPLACE,"prettier"),!0)},V={any:(y,A)=>(A.ctrlKey||A.metaKey)&&A.altKey&&A.shiftKey&&A.code==="KeyT"?(d.bus.emit(e,d.REPLACE,"table"),!0):!1},w={key:"Ctrl-d",mac:"Cmd-d",run:G.deleteLine,preventDefault:!0};return[o,w,r,i,n,h,b,m,s,g,x,p,k,f,v,u,C,V]},ho=bo,vo=e=>{const l=t.inject("tabWidth"),o=t.inject("editorId"),r=t.inject("theme"),i=t.ref(),n=t.shallowRef(),h=new T.Compartment,b=new T.Compartment,m=new T.Compartment,s=new T.Compartment,g=ho(o,e),x=go(e),p=[ae.keymap.of([...G.defaultKeymap,...G.historyKeymap,...g,G.indentWithTab]),s.of(G.history()),h.of(kt.markdown({codeLanguages:Ct.languages})),se.EditorView.lineWrapping,se.EditorView.updateListener.of(f=>{f.docChanged&&e.onChange(f.state.doc.toString())}),se.EditorView.domEventHandlers({paste:x,blur:e.onBlur,focus:e.onFocus,drop:e.onDrop,input:f=>{e.onInput&&e.onInput(f);const{data:v}=f;e.maxlength&&e.modelValue.length+v.length>e.maxlength&&d.bus.emit(o,d.ERROR_CATCHER,{name:"overlength",message:"The input text is too long",data:v})}})],k=()=>{const f=[...p,b.of(r.value==="light"?mt:nt),m.of(gt(e.completions))];return a.configOption.codeMirrorExtensions(r.value,f,[...g])};return t.onMounted(()=>{const f=new se.EditorView({doc:e.modelValue,parent:i.value,extensions:[k()]}),v=new mo(f);n.value=v,setTimeout(()=>{v.setTabSize(l),v.setDisabled(e.disabled),v.setReadOnly(e.readonly),e.placeholder&&v.setPlaceholder(e.placeholder),typeof e.maxlength=="number"&&v.setMaxLength(e.maxlength),e.autofocus&&f.focus()},0),d.bus.on(o,{name:d.CTRL_Z,callback(){G.undo(f)}}),d.bus.on(o,{name:d.CTRL_SHIFT_Z,callback(){G.redo(f)}}),d.bus.on(o,{name:d.REPLACE,callback(u,C={}){var y;const{text:V,options:w}=qt(u,n.value,C);(y=n.value)==null||y.replaceSelectedText(V,w,o)}})}),t.watch(r,()=>{var f;(f=n.value)==null||f.view.dispatch({effects:b.reconfigure(r.value==="light"?mt:nt)})},{deep:!0}),t.watch(()=>e.completions,()=>{var f;(f=n.value)==null||f.view.dispatch({effects:m.reconfigure(gt(e.completions))})},{deep:!0}),t.watch(()=>e.modelValue,()=>{var f,v;((f=n.value)==null?void 0:f.getValue())!==e.modelValue&&((v=n.value)==null||v.setValue(e.modelValue))}),t.watch(()=>e.placeholder,()=>{var f;(f=n.value)==null||f.setPlaceholder(e.placeholder)}),t.watch(()=>e.disabled,()=>{var f;(f=n.value)==null||f.setDisabled(e.disabled)}),t.watch(()=>e.readonly,()=>{var f;(f=n.value)==null||f.setDisabled(e.readonly)}),t.watch(()=>e.maxlength,()=>{var f;e.maxlength&&((f=n.value)==null||f.setMaxLength(e.maxlength))}),{inputWrapperRef:i,codeMirrorUt:n,resetHistory(){var f,v;(f=n.value)==null||f.view.dispatch({effects:s.reconfigure([])}),(v=n.value)==null||v.view.dispatch({effects:s.reconfigure(G.history())})}}},po=vo,Co=(e,l,o)=>{const r=t.reactive({resizedWidth:e.inputBoxWitdh}),i=t.reactive({width:e.inputBoxWitdh}),n=t.reactive({left:e.inputBoxWitdh,display:"initial"}),h=s=>{var f,v,u;const g=((f=l.value)==null?void 0:f.offsetWidth)||0,x=((v=l.value)==null?void 0:v.getBoundingClientRect().x)||0;let p=s.x-x;p<a.MinInputBoxWidth?p=a.MinInputBoxWidth:p>g-a.MinInputBoxWidth&&(p=g-a.MinInputBoxWidth);const k=`${p}px`;i.width=k,n.left=k,r.resizedWidth=k,(u=e.onInputBoxWitdhChange)==null||u.call(e,k)},b=()=>{document.addEventListener("mousemove",h)},m=()=>{document.removeEventListener("mousemove",h)};return t.onMounted(()=>{var s;(s=o.value)==null||s.addEventListener("mousedown",b),document.addEventListener("mouseup",m)}),t.onBeforeUnmount(()=>{var s,g;(s=o.value)==null||s.removeEventListener("mousedown",b),(g=o.value)==null||g.removeEventListener("mouseup",m)}),t.watch(()=>e.inputBoxWitdh,s=>{s&&(i.width=s,n.left=s)}),t.watch([t.toRef(e.setting,"htmlPreview"),t.toRef(e.setting,"preview")],()=>{!e.setting.htmlPreview&&!e.setting.preview?(i.width="100%",n.display="none"):(i.width=r.resizedWidth,n.display="initial")},{immediate:!0}),{inputWrapperStyle:i,resizeOperateStyle:n}},ko=Co,xo=t.defineComponent({name:"MDEditorContent",props:P.contentProps,setup(e,l){const o=t.inject("editorId"),r=t.ref(""),i=t.ref(),n=t.ref(),{inputWrapperRef:h,codeMirrorUt:b,resetHistory:m}=po(e),{inputWrapperStyle:s,resizeOperateStyle:g}=ko(e,i,n);return Ft(e,r,b),l.expose({getSelectedText(){var x;return(x=b.value)==null?void 0:x.getSelectedText()},focus(x){var p;(p=b.value)==null||p.focus(x)},resetHistory:m}),()=>t.createVNode("div",{class:`${a.prefix}-content${e.setting.htmlPreview||e.setting.preview?" has-preview":""}`,ref:i},[t.createVNode("div",{class:`${a.prefix}-input-wrapper`,style:s,ref:h},null),(e.setting.htmlPreview||e.setting.preview)&&t.createVNode("div",{class:`${a.prefix}-resize-operate`,style:g,ref:n},null),t.createVNode(P.ContentPreview,{modelValue:e.modelValue,setting:e.setting,onHtmlChanged:x=>{r.value=x,e.onHtmlChanged(x)},onGetCatalog:e.onGetCatalog,mdHeadingId:e.mdHeadingId,noMermaid:e.noMermaid,sanitize:e.sanitize,noKatex:e.noKatex,formatCopiedText:e.formatCopiedText,noHighlight:e.noHighlight,noImgZoomIn:e.noImgZoomIn,sanitizeMermaid:e.sanitizeMermaid},null),e.catalogVisible&&t.createVNode(bt,{theme:e.theme,class:`${a.prefix}-catalog-editor`,editorId:o,mdHeadingId:e.mdHeadingId,key:"internal-catalog"},null)])}}),$o=t.defineComponent({props:{modelValue:{type:String,default:""}},setup(e){const l=t.inject("usedLanguageText");return()=>{var o,r;return t.createVNode("div",{class:`${a.prefix}-footer-item`},[t.createVNode("label",{class:`${a.prefix}-footer-label`},[`${(o=l.value.footer)==null?void 0:o.markdownTotal}:`]),t.createVNode("span",null,[((r=e.modelValue)==null?void 0:r.length)||0])])}}}),No={checked:{type:Boolean,default:!1},onChange:{type:Function,default:()=>{}}},Vo=t.defineComponent({props:No,setup(e){return()=>t.createVNode("div",{class:[`${a.prefix}-checkbox`,e.checked&&`${a.prefix}-checkbox-checked`],onClick:()=>{e.onChange(!e.checked)}},null)}}),wo={scrollAuto:{type:Boolean},onScrollAutoChange:{type:Function,default:()=>{}}},yo=t.defineComponent({props:wo,setup(e){const l=t.inject("usedLanguageText");return()=>{var o;return t.createVNode("div",{class:`${a.prefix}-footer-item`},[t.createVNode("label",{class:`${a.prefix}-footer-label`,onClick:()=>{e.onScrollAutoChange(!e.scrollAuto)}},[(o=l.value.footer)==null?void 0:o.scrollAuto]),t.createVNode(Vo,{checked:e.scrollAuto,onChange:e.onScrollAutoChange},null)])}}}),To={modelValue:{type:String,default:""},footers:{type:Array,default:[]},scrollAuto:{type:Boolean},onScrollAutoChange:{type:Function,default:()=>{}},defFooters:{type:Object}},Eo=t.defineComponent({name:"MDEditorFooter",props:To,setup(e){const l=t.computed(()=>{const r=e.footers.indexOf("="),i=r===-1?e.footers:e.footers.slice(0,r),n=r===-1?[]:e.footers.slice(r,Number.MAX_SAFE_INTEGER);return[i,n]}),o=r=>{if(a.allFooter.includes(r))switch(r){case"markdownTotal":return t.createVNode($o,{modelValue:e.modelValue},null);case"scrollSwitch":return t.createVNode(yo,{scrollAuto:e.scrollAuto,onScrollAutoChange:e.onScrollAutoChange},null)}else return e.defFooters instanceof Array?e.defFooters[r]||"":e.defFooters&&e.defFooters.children instanceof Array&&e.defFooters.children[r]||""};return()=>{const r=l.value[0].map(n=>o(n)),i=l.value[1].map(n=>o(n));return t.createVNode("div",{class:`${a.prefix}-footer`},[t.createVNode("div",{class:`${a.prefix}-footer-left`},[r]),t.createVNode("div",{class:`${a.prefix}-footer-right`},[i])])}}}),So=t.defineComponent({name:"MdEditorV3",props:P.editorProps,emits:P.editorEmits,setup(e,l){const{editorId:o,noKatex:r,noMermaid:i,noPrettier:n,noUploadImg:h,noHighlight:b}=e,m=t.reactive({scrollAuto:e.scrollAuto}),s=t.ref();P.useOnSave(e,l),P.useProvide(e),P.useExpansion(e),P.useErrorCatcher(e,l);const[g,x]=P.useConfig(e,l),p=P.useCatalog(e);return t.onBeforeUnmount(()=>{d.bus.clear(o)}),P.useExpose(e,l,p,g,x,s),()=>{var v;const k=et.getSlot({props:e,ctx:l},"defToolbars"),f=et.getSlot({props:e,ctx:l},"defFooters");return t.createVNode("div",{id:o,class:[a.prefix,e.class,e.theme==="dark"&&`${a.prefix}-dark`,g.fullscreen||g.pageFullscreen?`${a.prefix}-fullscreen`:""],style:e.style},[t.createVNode(Ht,{noPrettier:n,toolbars:e.toolbars,toolbarsExclude:e.toolbarsExclude,setting:g,updateSetting:x,tableShape:e.tableShape,defToolbars:k,noUploadImg:h,showToolbarName:e.showToolbarName},null),t.createVNode(xo,{ref:s,modelValue:e.modelValue,setting:g,mdHeadingId:e.mdHeadingId,noMermaid:i,noPrettier:n,sanitize:e.sanitize,placeholder:e.placeholder,noKatex:r,scrollAuto:m.scrollAuto,formatCopiedText:e.formatCopiedText,autofocus:e.autoFocus,disabled:e.disabled,readonly:e.readOnly,maxlength:e.maxLength,autoDetectCode:e.autoDetectCode,noHighlight:b,onChange:u=>{e.onChange&&e.onChange(u),l.emit("update:modelValue",u),l.emit("onChange",u)},onHtmlChanged:u=>{e.onHtmlChanged&&e.onHtmlChanged(u),l.emit("onHtmlChanged",u)},onGetCatalog:u=>{e.onGetCatalog&&e.onGetCatalog(u),l.emit("onGetCatalog",u)},onBlur:u=>{e.onBlur&&e.onBlur(u),l.emit("onBlur",u)},onFocus:u=>{e.onFocus&&e.onFocus(u),l.emit("onFocus",u)},onInput:u=>{e.onInput&&e.onInput(u),l.emit("onInput",u)},completions:e.completions,catalogVisible:p.value,theme:e.theme,noImgZoomIn:e.noImgZoomIn,onDrop:u=>{e.onDrop&&e.onDrop(u),l.emit("onDrop",u)},inputBoxWitdh:e.inputBoxWitdh,onInputBoxWitdhChange:u=>{e.onInputBoxWitdhChange&&e.onInputBoxWitdhChange(u),l.emit("onInputBoxWitdhChange",u)},sanitizeMermaid:e.sanitizeMermaid},null),((v=e.footers)==null?void 0:v.length)>0&&t.createVNode(Eo,{modelValue:e.modelValue,footers:e.footers,defFooters:f,scrollAuto:m.scrollAuto,onScrollAutoChange:u=>m.scrollAuto=u},null)])}}}),de=So;de.install=e=>(e.component(de.name,de),e.use($t).use(Z.DropdownToolbar).use(Nt).use(bt).use(P.MdPreview),e);module.exports=de;
